<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>indigoX: Tutorials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">indigoX
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tutorials.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#usingcherrypicker">How to use CherryPicker</a><ul><li class="level2"><a href="#cherrypickeroverview">Overview</a></li>
<li class="level2"><a href="#cherrypickerfirststeps">First Steps</a></li>
<li class="level2"><a href="#cherrypickerathenaeum">Athenaeum generation</a></li>
<li class="level2"><a href="#cherrypickeralgo">Applying CherryPicker algorithm</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This page provides tutorials on how to use some of the classes and algorithms within the indigoX package. All these tutorials assume that you are using the provided Python bindings. The examples shown can all be run within the Python interpreter, with the proviso that the following two lines are included:</p>
<div class="fragment"><div class="line">import indigox <span class="keyword">as</span> ix</div><div class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</div></div><!-- fragment --><h1><a class="anchor" id="usingcherrypicker"></a>
How to use CherryPicker</h1>
<p>The CherryPicker algorithm is a parameterisation algorithm for molecular dynamics simulations. It parameterises novel molecules by identifying fragments of previously parameterised molecules which match portions of the novel molecule, then applying the parameters found to the novel molecule. This tutorial assumes that you are familar with molecule dynamics and parameterisation. A full working version of the code presented here can be found in the examples directory. For more in depth information about the algorithm, consult the <a class="el" href="classindigox_1_1algorithm_1_1_cherry_picker.html">CherryPicker documentation</a>.</p>
<h2><a class="anchor" id="cherrypickeroverview"></a>
Overview</h2>
<p>There are two main parts to using CherryPicker, producing Athenaeums to store fragments of previously parameterised molecules, and using these Athenaeums to apply the algorithm to parameterising a novel molecule. Fragments to store can either be automatically generated by the Athenaeum, or generated as defined in a <a class="el" href="fileformats.html#fragfile">fragment file</a>. One of main reasons for the use of Athenaeums is to enable one to generate an Athenaeum from some data set once and then save it to disk to enable reuse at a later date. Finally, the CherryPicker algorithm has a number of user controllable settings to dictate how the algorithm should behave. Use of all these aspects will be discussed, but first...</p>
<h2><a class="anchor" id="cherrypickerfirststeps"></a>
First Steps</h2>
<p>Before beginning, ensure that you have all the required files. Navigate to the examples/CherryPicker directory. This directory should contain three items: a python script (cherrypicker_example.py) containing the code presented here, and two subdirectories, SourceMolecules and TestMolecules. The SourceMolecules directory contains the previously parameterised molecules that we will be using for generating Athenaeums. There are twenty-two such molecules in total. Each molecule should have four files: a coordinate file (name_ua.pdb), a topology file (name.top), a <a class="el" href="fileformats.html#fragfile">fragment definition file</a> (name.frag), and a <a class="el" href="fileformats.html#ixdfile">data file</a> (name.ixd). Within the TestMolecules subdirectory, there are six files: a coordinate file (name.pdb) and a data file (name.ixd) for each of three molecules.</p>
<p>The first step on any parameterisation undertaking is to obtain a forcefield:</p>
<div class="fragment"><div class="line">ff = ix.GenerateGROMOS54A7()</div></div><!-- fragment --><p>Here, we use the included GROMOS 54A7 forcefield generator. Other methods for obtaining a forcefield are detailed in the <a class="el" href="classindigox_1_1_forcefield.html">forcefield documentation</a>. The forcefield chosen should be the same as the forcefield your previously parameterised molecules were parameterised with. This forcefield is provided when creating both an Athenaeum and a CherryPicker instance. When adding an Athenaeum to CherryPicker, it will only be successfully added if the forcefields used to create both the Athenaeum and CherryPicker instance match. Next, we move on to discussing Athenaeum generation.</p>
<h2><a class="anchor" id="cherrypickerathenaeum"></a>
Athenaeum generation</h2>
<p>As previously mentioned, there are two ways to add fragments to an Athenaeum, either by automatically generating all possible fragments of a given molecule, or by adding a fragment defined within a fragment definition file. There are also two types of Athenaeum, self-consistent and not self-consistent. A self-consistent Athenaeum is where if multiple fragments from the Athenaeum match to the same portion of a target molecule, all areas of overlapping matching will have the same parameters in each of the fragments. Generally speaking, you would not want to automatically generate fragments for a self-consistent Athenaeum.</p>
<p>Creating an Athenaeum is simple, just pass a forcefield and, optionally, an overlap length to the Athenaeum constructor.</p>
<div class="fragment"><div class="line">settings = ix.Athenaeum.Settings</div><div class="line">man_ath = ix.Athenaeum(ff)</div><div class="line">man_ath.SetBool(settings.SelfConsistent)</div><div class="line">auto_ath = ix.Athenaeum(ff, 1)</div></div><!-- fragment --><p>Here, we create two. The first, man_ath, is a self-consitent Athenaeum to which we will add all the defined fragments from the SourceMolecules subdirectory. As we are not automatically generating fragments using this Athenaeum, the overlap length is irrelevant. The second, auto_ath, is created with an overlap length of one and will be used to generate all possible fragments from each of the molecules within the SourceMolecules subdirectory. As some of our source molecules are larger than the default upper size limit for a molecule to be able to be automatically fragmented, we must change the setting.</p>
<div class="fragment"><div class="line">auto_ath.SetInt(settings.MoleculeSizeLimit, 60)</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Care should be taken with changing the upper size limit. The fragment generation algorithm technically scales as <img class="formulaInl" alt="$ 2^n $" src="form_2.png"/>, where <img class="formulaInl" alt="$ n $" src="form_3.png"/> is the number of vertices in the condensed molecular graph. Practically, the scaling is not as bad as this due to the nature of chemical graphs. Nevertheless, with too large a molecule, the computational time required can become unrealistic.</dd></dl>
<p>Once the Athenaeums have been prepared, all that remains is generate the fragments.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> frag_file <span class="keywordflow">in</span> Path(<span class="stringliteral">&quot;SourceMolecules&quot;</span>).glob(<span class="stringliteral">&quot;*.frag&quot;</span>):</div><div class="line">  mol, fragments = ix.LoadFragmentFile(frag_file, ff)</div><div class="line">  <span class="keywordflow">for</span> fragment <span class="keywordflow">in</span> fragments: man_ath.AddFragment(fragment)</div><div class="line">  auto_ath.AddAllFragments(mol)</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Execution of this block of code can take a substainial time, and use a large amount of memory. Locally, this equated to an execution time of approximately 400 seconds and a maximum memory usage of around 3.5 GB.</dd></dl>
<p>Lets go through this line by line. The first line locates all the fragment definition files within the SourceMolecules directory, so the loop will be executed 22 times, once for each source molecule. The next line loads the fragment file. The LoadFragmentFile() function returns the molecule which the fragments are from, and the list of all fragments defined within the file. The forcefield is provided as internally, the LoadParameterisedMolecule() function is called to load the molecule. Line three, the inner loop, adds all of the fragments which were defined in the fragment file into the first athenaeum. Here we do not check the return value of the AddFragment() method, but it general it should be checked to ensure that the fragment was correctly added. For the fragment to be successfully added, its source molecule must be parameterised and the forcefield used for parameterisation must match the forcefield used to create the Athenaeum. The final line adds all possible fragments from the loaded molecule to the second Athenaeum. See the <a class="el" href="classindigox_1_1_athenaeum.html#ab83f209a925edd107bd8e2c1a50ac931">AddAllFragments()</a> method documentation for a description of the algorithm used.</p>
<p>Finally, we save the Athenaeums to disk. The files are saved in a portable binary format, meaning they should work across different computer systems.</p>
<div class="fragment"><div class="line">ix.SaveAthenaeum(man_ath, <span class="stringliteral">&quot;ManualAthenaeum.ath&quot;</span>)</div><div class="line">ix.SaveAthenaeum(auto_ath, <span class="stringliteral">&quot;AutomaticAthenaeum.ath&quot;</span>)</div></div><!-- fragment --><p>For further Athenaeum information, consult the <a class="el" href="classindigox_1_1_athenaeum.html">Athenaeum documentation</a>.</p>
<h2><a class="anchor" id="cherrypickeralgo"></a>
Applying CherryPicker algorithm</h2>
<p>To discuss the application of the CherryPicker algorithm we assume a clean slate. That is, that the previous Athenaeum generation has been run, but the saved files need to be reloaded. As such, the first step is to load the Athenaeums we wish to parameterise from.</p>
<div class="fragment"><div class="line">man_ath = ix.LoadAthenaeum(<span class="stringliteral">&quot;ManualAthenaeum.ath&quot;</span>)</div><div class="line">auto_ath = ix.LoadAthenaeum(<span class="stringliteral">&quot;AutomaticAthenaeum.ath&quot;</span>)</div></div><!-- fragment --><p>Next, we must create an CherryPicker instance. To ensure that the forcefield we create the instance with matches that of the Athenaeums we are going to add, we first retrieve the forcefield from one of the Athenaeums.</p>
<div class="fragment"><div class="line">ff = man_ath.GetForcefield()</div><div class="line">cherrypicker = ix.algorithm.CherryPicker(ff)</div></div><!-- fragment --><p>Now it is time to add the Athenaeums to the CherryPicker instance. For this example, we have two Athenaeums, a small self-consistent one and a much larger automatically generated one. As we are more confident in the parameters within the small Athenaeum, and that CherryPicker iterates through Athenaeums in a first in-first out manner, the small Athenaeum should be added first.</p>
<div class="fragment"><div class="line">cherrypicker.AddAthenaeum(man_ath)</div><div class="line">cherrypicker.AddAthenaeum(auto_ath)</div></div><!-- fragment --><p>And change some of the default CherryPicker settings.</p>
<div class="fragment"><div class="line">settings = ix.algorithm.CherryPicker.Settings</div><div class="line">cherrypicker.SetInt(settings.MinimumFragmentSize, 2)</div><div class="line">cherrypicker.SetInt(settings.MaximumFragmentSize, 20)</div></div><!-- fragment --><p>With this setup performed, we are ready to parameterise our test molecules. As there are three test molecules, we loop over them, applying the parameteristion and saving the resultant parameters to a GROMACS ITP file.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> test <span class="keywordflow">in</span> Path(<span class="stringliteral">&quot;TestMolecules&quot;</span>).glob(<span class="stringliteral">&quot;*.pdb&quot;</span>):</div><div class="line">  mol = ix.LoadPDBFile(test, test.with_suffix(<span class="stringliteral">&quot;.ixd&quot;</span>))</div><div class="line">  parameterised = cherrypicker.ParameteriseMolecule(mol)</div><div class="line">  ix.SaveITPFile(test.with_suffix(<span class="stringliteral">&quot;.itp&quot;</span>), mol, parameterised)</div></div><!-- fragment --><p>By providing the returned parameterised molecule to the save function, the output ITP file will contain additional statistics related to the parameterisation. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Feb 19 2019 07:25:32 for indigoX by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
